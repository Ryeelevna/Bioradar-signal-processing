# Обработка биорадиолокационного сигнала для диагностики апноэ сна

Данная программа является компонентом биотехнической системы, базирующейся на использовании биорадиолокатора и предназначенной для удалённого бесконтактного мониторинга состояния спящего пациента с нарушениями дыхания во сне.

Программа реализована в среде MATLAB в 2020 году.

Протестирована на пациенте с синдромом апноэ сна. Представленный далее пример работы программы основан на результатах проведённых тестов.

Алгоритм обрабатывает и анализирует радиосигнал, содержащий информацию о движениях тела пациента во сне. Его целью является поиск и обнаружение эпизодов апноэ с точностью, достаточной для оценки тяжести нарушений дыхания во сне. Сигнал получается путём генерации радиочастотным приёмопередатчиком и последующего его отражения от биообъекта. Информативными в нём являются записи дыхательных движений, а также пульсаций сердца и поверхностно залегающих крупных сосудов. С помощью них определяются параметры паттернов сердцебиения и дыхания в частотной и временной областях, которые и позволяют обнаруживать эпизоды остановки дыхания.

Основные части программы: предобработка сигнала, формирование пространства признаков и классификация событий с использованием обученного классификатора.

Функция предобработки заключается в подготовке данных для классификатора. Исходный сигнал состоит из двух квадратур, из которых формируется комбинированый сигнал, а он в свою очередь анализируется для выявления дыхательных периодов.

Пример исходного сигнал (некоторый участок в укрупнённом масштабе):

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_01.png)

В нём чётко различимы участки чистого информативного сигнала с дыхательным паттерном, а также артефакты движения человека во время сна. Движения - это изменения положения тела, и каждому межартефактному периоду соответствует новое положение, при котором сигнал лучшего качества содержится в одной из квадратур. Поэтому комбинированный сигнал составляется из межартефактных фрагментов разных каналов, в зависимости от того, где качество сигнала лучше.

Поиск артефактов движения осуществляется с использованием скользящего окна. В каждом фрагменте сигнала, попавшем окно, производится два вида анализа: во временной и частотной области. Вычисляется средняя энергия участка сигнала, которая затем сравнивается с пороговыми значениями, полученными из предварительно рассчитанной средней энергии всего сигнала, и квадратом амплитуды основной гармоники. Обнаруженные артефакты выделены на графике прямоугольниками:

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_02.png)

Распознавание дыхательных периодов в комбинированном сигнале производится также с помощью скользящего окна, но с адаптивными параметрами, меняющимися в зависимости от частоты дыхания и улучшающими точность распознавания.

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_03.png)

Набор данных, использованный для обучения классификатора, был составлен из вектора признаков, полученного из результатов предобработки тестового сигнала, а также из вектора ответов, извлечённого из данных полисомнографического мониторинга, проводившегося одновременно с регистрацией БРЛ сигнала. Вектор ответов - это матрица категориального формата, содержащая данные в виде двух классов: нормальное дыхание и апноэ любого типа + гипопноэ.

Вектор признаков формируется из нескольких параметров сигнала по каждому выявленному дыхательному периоду. Параметры были выбраны с помощью корреляционного анализа, который из всего набора различных параметров позволяет избрать несколько наиболее незавизимых друг от друга и тем самым максимизировать точность классификации. Корреляционная матрица ниже содержит коэффициенты корреляции для каждой пары признаков; исключённые параметры выделены красным цветом:

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_04.PNG)

Для обучения классификатора было использовано приложение Classification Learner, в который импортировался подготовленный набор данных, а затем, с применением 5-слойной кросс-валидации, производилось обучение моделей всеми доступными методами, из которых в результате было выбрано только несколько, лучшие с точки зрения точности классификации ими данных. Для определения точности и выбора лучших моделей для данного анализа использовался метод построения кривых рабочих характеристик приёмника, которые показывают истинноположительный показатель по сравнению с ложноположительным для разных порогов выхода классификатора. Идеальный результат без ошибочно классифицированных сэмплов – это прямой угол в левом верхнем углу графика. Площадь под кривой (AUC) является показателем общего качества классификатора.

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_05.PNG)
![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_06.PNG)
![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_10.PNG)

Наиболее производительными оказались Fine Tree, Fine KNN, Gaussian Naive Bayes и RUSBoosted Trees.

Обученные классификаторы в программе используются для классификации набора фрагментов сна, и с помощью них становится возможным выявление эпизодов апноэ / гипопноэ на импортируемых пользователем данных с определённой для каждого из них точностью. Графики ниже наглядно представляют результат работы программы: на тестовом сигнале отмечены реальные эпизоды остановки дыхания, известные из данных ПСГ мониторинга, (выделены красными прямоугольниками) и те, которые были обнаружены программой (выделены жёлтыми прямоугольниками).

![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_07.PNG)
![alt text](https://github.com/Ryeelevna/Bioradar-signal-processing/blob/main/pics/br_08.PNG)
